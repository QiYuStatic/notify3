import"./config.9af19bbc.js";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},l={},a=e.parcelRequire143b;null==a&&((a=function(e){if(e in t)return t[e].exports;if(e in l){var a=l[e];delete l[e];var s={id:e,exports:{}};return t[e]=s,a.call(s.exports,s,s.exports),s.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){l[e]=t},e.parcelRequire143b=a);var s,i=a("jAw9N"),n=a("ejx16"),r=a("fcdvt"),o=a("azvlV"),d=a("5iahp"),p=(n=a("ejx16"),a("fMI85"));!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(s||(s={}));function c(e){void 0===e&&(e={});var t=e.window,l=void 0===t?document.defaultView:t,a=l.history;function i(){var e=l.location,t=e.pathname,s=e.search,i=e.hash,n=a.state||{};return[n.idx,{pathname:t,search:s,hash:i,state:n.usr||null,key:n.key||"default"}]}var n=null;l.addEventListener("popstate",(function(){if(n)g.call(n),n=null;else{var e=s.Pop,t=i(),l=t[0],a=t[1];if(g.length){if(null!=l){var r=d-l;r&&(n={action:e,location:a,retry:function(){T(-1*r)}},T(r))}}else b(e)}}));var r=s.Pop,o=i(),d=o[0],c=o[1],m=u(),g=u();function y(e){return"string"==typeof e?e:_(e)}function w(e,t){return void 0===t&&(t=null),p.default({pathname:c.pathname,hash:"",search:""},"string"==typeof e?j(e):e,{state:t,key:x()})}function f(e,t){return[{usr:e.state,key:e.key,idx:t},y(e)]}function v(e,t,l){return!g.length||(g.call({action:e,location:t,retry:l}),!1)}function b(e){r=e;var t=i();d=t[0],c=t[1],m.call({action:r,location:c})}function T(e){a.go(e)}null==d&&(d=0,a.replaceState(p.default({},a.state,{idx:d}),""));var C={get action(){return r},get location(){return c},createHref:y,push:function e(t,i){var n=s.Push,r=w(t,i);if(v(n,r,(function(){e(t,i)}))){var o=f(r,d+1),p=o[0],c=o[1];try{a.pushState(p,"",c)}catch(e){l.location.assign(c)}b(n)}},replace:function e(t,l){var i=s.Replace,n=w(t,l);if(v(i,n,(function(){e(t,l)}))){var r=f(n,d),o=r[0],p=r[1];a.replaceState(o,"",p),b(i)}},go:T,back:function(){T(-1)},forward:function(){T(1)},listen:function(e){return m.push(e)},block:function(e){var t=g.push(e);return 1===g.length&&l.addEventListener("beforeunload",h),function(){t(),g.length||l.removeEventListener("beforeunload",h)}}};return C}function h(e){e.preventDefault(),e.returnValue=""}function u(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function x(){return Math.random().toString(36).substr(2,8)}function _(e){var t=e.pathname,l=void 0===t?"/":t,a=e.search,s=void 0===a?"":a,i=e.hash,n=void 0===i?"":i;return s&&"?"!==s&&(l+="?"===s.charAt(0)?s:"?"+s),n&&"#"!==n&&(l+="#"===n.charAt(0)?n:"#"+n),l}function j(e){var t={};if(e){var l=e.indexOf("#");l>=0&&(t.hash=e.substr(l),e=e.substr(0,l));var a=e.indexOf("?");a>=0&&(t.search=e.substr(a),e=e.substr(0,a)),e&&(t.pathname=e)}return t}const m=(n=a("ejx16")).createContext(null),g=n.createContext(null),y=n.createContext({outlet:null,matches:[]});function w(e,t){if(!e)throw new Error(t)}function f(e,t,l){void 0===l&&(l="/");let a=H(("string"==typeof t?j(t):t).pathname||"/",l);if(null==a)return null;let s=v(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){return e.length===t.length&&e.slice(0,-1).every(((e,l)=>e===t[l]))?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(s);let i=null;for(let e=0;null==i&&e<s.length;++e)i=S(s[e],a);return i}function v(e,t,l,a){return void 0===t&&(t=[]),void 0===l&&(l=[]),void 0===a&&(a=""),e.forEach(((e,s)=>{let i={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:s,route:e};i.relativePath.startsWith("/")&&(!i.relativePath.startsWith(a)&&w(!1),i.relativePath=i.relativePath.slice(a.length));let n=B([a,i.relativePath]),r=l.concat(i);e.children&&e.children.length>0&&(!0===e.index&&w(!1),v(e.children,t,r,n)),(null!=e.path||e.index)&&t.push({path:n,score:C(n,e.index),routesMeta:r})})),t}const b=/^:\w+$/,T=e=>"*"===e;function C(e,t){let l=e.split("/"),a=l.length;return l.some(T)&&(a+=-2),t&&(a+=2),l.filter((e=>!T(e))).reduce(((e,t)=>e+(b.test(t)?3:""===t?1:10)),a)}function S(e,t){let{routesMeta:l}=e,a={},s="/",i=[];for(let e=0;e<l.length;++e){let n=l[e],r=e===l.length-1,o="/"===s?t:t.slice(s.length)||"/",d=A({path:n.relativePath,caseSensitive:n.caseSensitive,end:r},o);if(!d)return null;Object.assign(a,d.params);let p=n.route;i.push({params:a,pathname:B([s,d.pathname]),pathnameBase:L(B([s,d.pathnameBase])),route:p}),"/"!==d.pathnameBase&&(s=B([s,d.pathnameBase]))}return i}function A(e,t){"string"==typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[l,a]=function(e,t,l){void 0===t&&(t=!1);void 0===l&&(l=!0);let a=[],s="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,((e,t)=>(a.push(t),"([^\\/]+)")));e.endsWith("*")?(a.push("*"),s+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):s+=l?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(s,t?void 0:"i"),a]}(e.path,e.caseSensitive,e.end),s=t.match(l);if(!s)return null;let i=s[0],n=i.replace(/(.)\/+$/,"$1"),r=s.slice(1);return{params:a.reduce(((e,t,l)=>{if("*"===t){let e=r[l]||"";n=i.slice(0,i.length-e.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(t){return e}}(r[l]||""),e}),{}),pathname:i,pathnameBase:n,pattern:e}}function k(e,t,l){let a,s="string"==typeof e?j(e):e,i=""===e||""===s.pathname?"/":s.pathname;if(null==i)a=l;else{let e=t.length-1;if(i.startsWith("..")){let t=i.split("/");for(;".."===t[0];)t.shift(),e-=1;s.pathname=t.join("/")}a=e>=0?t[e]:"/"}let n=function(e,t){void 0===t&&(t="/");let{pathname:l,search:a="",hash:s=""}="string"==typeof e?j(e):e,i=l?l.startsWith("/")?l:function(e,t){let l=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?l.length>1&&l.pop():"."!==e&&l.push(e)})),l.length>1?l.join("/"):"/"}(l,t):t;return{pathname:i,search:W(a),hash:U(s)}}(s,a);return i&&"/"!==i&&i.endsWith("/")&&!n.pathname.endsWith("/")&&(n.pathname+="/"),n}function H(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let l=e.charAt(t.length);return l&&"/"!==l?null:e.slice(t.length)||"/"}const B=e=>e.join("/").replace(/\/\/+/g,"/"),L=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),W=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",U=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";function q(){return null!=n.useContext(g)}function F(){return!q()&&w(!1),n.useContext(g).location}function P(){!q()&&w(!1);let{basename:e,navigator:t}=n.useContext(m),{matches:l}=n.useContext(y),{pathname:a}=F(),s=JSON.stringify(l.map((e=>e.pathnameBase))),i=n.useRef(!1);return n.useEffect((()=>{i.current=!0})),n.useCallback((function(l,n){if(void 0===n&&(n={}),!i.current)return;if("number"==typeof l)return void t.go(l);let r=k(l,JSON.parse(s),a);"/"!==e&&(r.pathname=B([e,r.pathname])),(n.replace?t.replace:t.push)(r,n.state)}),[e,t,s,a])}function R(e,t){return void 0===t&&(t=[]),null==e?null:e.reduceRight(((l,a,s)=>n.createElement(y.Provider,{children:void 0!==a.route.element?a.route.element:l,value:{outlet:l,matches:t.concat(e.slice(0,s+1))}})),null)}function D(e){let{to:t,replace:l,state:a}=e;!q()&&w(!1);let s=P();return n.useEffect((()=>{s(t,{replace:l,state:a})})),null}function M(e){w(!1)}function E(e){let{basename:t="/",children:l=null,location:a,navigationType:i=s.Pop,navigator:r,static:o=!1}=e;q()&&w(!1);let d=L(t),p=n.useMemo((()=>({basename:d,navigator:r,static:o})),[d,r,o]);"string"==typeof a&&(a=j(a));let{pathname:c="/",search:h="",hash:u="",state:x=null,key:_="default"}=a,y=n.useMemo((()=>{let e=H(c,d);return null==e?null:{pathname:e,search:h,hash:u,state:x,key:_}}),[d,c,h,u,x,_]);return null==y?null:n.createElement(m.Provider,{value:p},n.createElement(g.Provider,{children:l,value:{location:y,navigationType:i}}))}function I(e){let{children:t,location:l}=e;return function(e,t){!q()&&w(!1);let l,{matches:a}=n.useContext(y),s=a[a.length-1],i=s?s.params:{},r=(s&&s.pathname,s?s.pathnameBase:"/"),o=(s&&s.route,F());if(t){var d;let e="string"==typeof t?j(t):t;"/"!==r&&!(null==(d=e.pathname)?void 0:d.startsWith(r))&&w(!1),l=e}else l=o;let p=l.pathname||"/",c=f(e,{pathname:"/"===r?p:p.slice(r.length)||"/"});return R(c&&c.map((e=>Object.assign({},e,{params:Object.assign({},i,e.params),pathname:B([r,e.pathname]),pathnameBase:"/"===e.pathnameBase?r:B([r,e.pathnameBase])}))),a)}(z(t),l)}function z(e){let t=[];return n.Children.forEach(e,(e=>{if(!n.isValidElement(e))return;if(e.type===n.Fragment)return void t.push.apply(t,z(e.props.children));e.type!==M&&w(!1);let l={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(l.children=z(e.props.children)),t.push(l)})),t}function N(e){let{basename:t,children:l,window:a}=e,s=n.useRef();null==s.current&&(s.current=c({window:a}));let i=s.current,[r,o]=n.useState({action:i.action,location:i.location});return n.useLayoutEffect((()=>i.listen(o)),[i]),n.createElement(E,{basename:t,children:l,location:r.location,navigationType:r.action,navigator:i})}var V=a("gC0Hh"),$=a("6pMsr");i=a("jAw9N"),n=a("ejx16"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class G extends n.Component{static defaultProps={show_text:"加载中..."};constructor(e){super(e),this.state={}}render(){return this.props.loading?i.jsx(i.Fragment,{children:i.jsxs("div",{style:{textAlign:"center",margin:"auto",padding:"2em"},children:[i.jsx(o.CircularProgress,{size:"5em",variant:"indeterminate"}),i.jsx(o.Typography,{style:{paddingTop:"1em"},children:this.props.show_text})]})}):i.jsx(i.Fragment,{})}}var X=a("iX1d0");$=a("6pMsr"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),V=a("gC0Hh"),$=a("6pMsr"),X=a("iX1d0");class O extends n.Component{constructor(e){super(e),this.state={msg_list:[],loading:!1}}async componentDidMount(){try{this.setState({loading:!0});const e=await X.ApiWxMsgList.do_get({path_args:null,query_args:{unique_id:this.props.unique_id},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});this.setState({msg_list:e||[]})}catch(e){console.error({msg:"fetch wx msg",e:e})}finally{this.setState({loading:!1})}}render(){return i.jsxs(i.Fragment,{children:[i.jsx(V.HeaderBlock,{}),i.jsxs(o.Container,{style:{paddingTop:"35px"},children:[i.jsxs(o.Breadcrumbs,{children:[i.jsx(o.Link,{onClick:async()=>{await this.props.onCloseHandler()},children:"微信配置"}),i.jsx(o.Link,{children:this.props.unique_id})]}),i.jsx(o.Typography,{variant:"h4",align:"center",children:"消息列表"}),i.jsx(G,{loading:this.state.loading}),this.tableUI()]})]})}tableUI=()=>{if(0===this.state.msg_list.length)return i.jsx(o.Alert,{severity:"error",children:"当前没有消息"});return i.jsx(i.Fragment,{children:i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"发送IP"}),i.jsx(o.TableCell,{children:"消息类型"}),i.jsx(o.TableCell,{children:"消息内容"}),i.jsx(o.TableCell,{children:"发送时间"})]})}),i.jsx(o.TableBody,{children:this.state.msg_list.map(((e,t)=>{return l=t,a=e,i.jsx(i.Fragment,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:a.src_ip}),i.jsx(o.TableCell,{children:a.msg_type}),i.jsx(o.TableCell,{style:{maxWidth:"60vw"},children:i.jsx("pre",{children:a.content})}),i.jsx(o.TableCell,{children:new Date(a.ctime).toLocaleString()})]},l)});var l,a}))})]})})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class J extends n.Component{static defaultProps={title:"确认删除?"};constructor(e){super(e),this.state={},console.log("show dialog props:",e)}render(){return i.jsxs(o.Dialog,{open:null!==this.props.value,children:[i.jsx(o.DialogTitle,{id:"alert-dialog-title",children:this.props.title}),i.jsx(o.DialogContent,{style:{minWidth:"20vw"},children:i.jsx(o.DialogContentText,{id:"alert-dialog-description",children:this.props.content})}),i.jsxs(o.DialogActions,{children:[i.jsx(o.Button,{color:"primary",autoFocus:!0,onClick:async()=>{await this.props.closeHandler()},children:"关闭"}),i.jsx(o.Button,{color:"secondary",onClick:async()=>{await this.props.confirmHandler(this.props.value)},children:"确认"})]})]})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),d=a("5iahp");class K extends n.Component{static defaultProps={};constructor(e){super(e),this.state={i_type:"password"}}render(){return i.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[this.eyeUI(),i.jsx("div",{style:{width:"1em"}}),this.txtUI()]})}eyeUI=()=>"password"===this.state.i_type?i.jsx(d.Visibility,{onClick:()=>{this.setState({i_type:"text"})}}):i.jsx(d.VisibilityOff,{onClick:()=>{this.setState({i_type:"password"})}});txtUI=()=>"password"===this.state.i_type?i.jsx(o.Typography,{children:"******"}):i.jsx(o.Typography,{children:this.props.value})}class Q extends n.Component{constructor(e){super(e),this.state={}}render(){const e=this.props.wx_list;return e&&0!==e.length?i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"唯一标识"}),i.jsx(o.TableCell,{children:"应用名称"}),i.jsx(o.TableCell,{children:"公司ID"}),i.jsx(o.TableCell,{children:"微信令牌"}),i.jsx(o.TableCell,{children:"AES密钥"}),i.jsx(o.TableCell,{children:"代理ID"}),i.jsx(o.TableCell,{children:"密钥"}),i.jsx(o.TableCell,{children:"操作"})]})}),i.jsx(o.TableBody,{children:e.map(this.renderRow)})]}):i.jsx(o.Typography,{align:"center",fontSize:"2em",children:"您没有企业微信的推送配置"})}renderRow=e=>i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:i.jsx(o.Tooltip,{title:"查看详情",children:i.jsx(o.Link,{onClick:async()=>{await this.props.showWxAppDetailHandler(e)},children:e.unique_id})})}),i.jsx(o.TableCell,{children:e.app_name}),i.jsx(o.TableCell,{children:e.corp_id}),i.jsx(o.TableCell,{children:i.jsx(K,{value:e.wx_token})}),i.jsx(o.TableCell,{children:i.jsx(K,{value:e.aes_key})}),i.jsx(o.TableCell,{children:e.agent_id}),i.jsx(o.TableCell,{children:i.jsx(K,{value:e.secret})}),i.jsx(o.TableCell,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Tooltip,{title:"删除这个推送配置?",placement:"top",children:i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.deleteWxAppHandler(e)},children:"删除"})}),i.jsx(o.Button,{variant:"outlined",onClick:async()=>{await this.props.showWxMsgListHandler(e.unique_id)},children:"查看信息"})]})})]},e.unique_id)}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class Y extends n.Component{constructor(e){super(e),this.state={copied:!1}}render(){if(null===this.props.value)return i.jsx(i.Fragment,{});let e=null;return e=this.state.copied?"已复制":"点击复制",i.jsx(o.TextField,{value:this.props.value,label:this.props.label,variant:"filled",helperText:this.props.helperText,fullWidth:!0,InputProps:{readOnly:!0,"aria-readonly":!0,endAdornment:i.jsx(o.InputAdornment,{position:"end",children:i.jsx(o.Button,{variant:"contained",onClick:async()=>{await navigator.clipboard.writeText(this.props.value),this.setState({copied:!0})},children:e})})}})}}class Z{static buildUrlWithPath(e){return`${document.location.protocol}//${document.location.host}${e}`}}class ee extends n.Component{constructor(e){super(e),this.state={}}render(){return null===this.props.wx_app?i.jsx(i.Fragment,{}):i.jsxs("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[i.jsx("div",{children:i.jsx(Y,{value:this.wxCbUrl(),label:"微信验证URL",helperText:"微信验证回调的URL链接"})}),i.jsx("div",{children:i.jsx(Y,{value:this.textNotifyUrl(),label:"文本通知URL",helperText:"接收文本通知的URL"})}),i.jsx("div",{children:i.jsx(Y,{value:this.mdNotifyUrl(),label:"markdown通知URL",helperText:"接收markdown通知的URL"})}),i.jsx("div",{children:i.jsx(Y,{value:this.chatwootWebookUrl(),label:"Chatwoot WebHook URL",helperText:"Chatwoot WebHook 通知 URL"})}),i.jsx("div",{children:i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandler()},children:"关闭"})})]})}wxCbUrl=()=>{const e=this.props.wx_app?.unique_id;return Z.buildUrlWithPath(`/api/wx/verify/${e}`)};chatwootWebookUrl=()=>{const e=this.props.wx_app?.unique_id;return Z.buildUrlWithPath(`/api/wx/chatwoot/${e}`)};textNotifyUrl=()=>{const e=this.props.wx_app?.unique_id;return Z.buildUrlWithPath(`/api/wx/notify/${e}`)};mdNotifyUrl=()=>{const e=this.props.wx_app?.unique_id;return Z.buildUrlWithPath(`/api/wx/md/${e}`)}}class te extends n.Component{constructor(e){super(e),this.state={wx_list:[],loading:!0,secret_type:"password",show_msg_unique:null,delete_wx_app:null,show_app_detail:null}}async componentDidMount(){await this.reloadWxList()}render(){return this.state.show_msg_unique?i.jsx(O,{unique_id:this.state.show_msg_unique,onCloseHandler:async()=>{this.setState({show_msg_unique:null})}}):this.state.show_app_detail?i.jsx(ee,{wx_app:this.state.show_app_detail,closeHandler:async()=>{this.setState({show_app_detail:null})}}):i.jsxs(i.Fragment,{children:[i.jsx(G,{loading:this.state.loading}),i.jsx(Q,{wx_list:this.state.wx_list,showWxAppDetailHandler:async e=>{this.setState({show_app_detail:e})},showWxMsgListHandler:async e=>{this.setState({show_msg_unique:e})},deleteWxAppHandler:async e=>{this.setState({delete_wx_app:e}),console.log("set delete unique id:",e.unique_id)}}),i.jsx(J,{closeHandler:async()=>{this.setState({delete_wx_app:null})},confirmHandler:async e=>{await this.doDeleteWx(e.unique_id),this.setState({delete_wx_app:null})},value:this.state.delete_wx_app,content:`您确认删除: ${this.state.delete_wx_app?.app_name}?`})]})}reloadWxList=async()=>{try{this.setState({loading:!0});const e=await X.ApiWxAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});e&&this.setState({wx_list:e})}catch(e){console.error(e)}finally{this.setState({loading:!1})}};doDeleteWx=async e=>{this.setState({delete_wx_app:null}),await X.ApiWxApp.do_delete({path_args:null,query_args:{unique_id:e},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}},(async e=>(console.log({resp:e}),await this.reloadWxList(),{})),(async e=>(console.error({resp:e,text:await e.text()}),alert("删除失败"),{})))}}i=a("jAw9N"),n=a("ejx16"),i=a("jAw9N"),n=a("ejx16"),X=a("iX1d0"),$=a("6pMsr"),o=a("azvlV"),i=a("jAw9N"),n=a("ejx16"),d=a("5iahp");class le extends n.Component{static defaultProps={};constructor(e){super(e),this.state={}}render(){return this.props.value?i.jsx(d.Check,{color:"primary"}):i.jsx(d.Clear,{color:"secondary"})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),X=a("iX1d0");class ae extends n.Component{constructor(e){super(e),this.state={verify_code:"",verify_failed:!1}}render(){return null===this.props.email_app?i.jsx(i.Fragment,{}):i.jsx(i.Fragment,{children:i.jsxs(o.Dialog,{open:!0,children:[i.jsxs(o.DialogTitle,{children:["邮箱验证:",this.props.email_app.notify_email]}),i.jsxs(o.DialogContent,{children:[this.failedUI(),i.jsx(o.DialogContentText,{children:"请在下方输入您接收到的验证码:"}),i.jsx(o.TextField,{value:this.state.verify_code,autoFocus:!0,margin:"dense",label:"验证码:",type:"text",fullWidth:!0,onChange:e=>{this.setState({verify_code:e.target.value})}})]}),i.jsxs(o.DialogActions,{children:[i.jsx(o.Button,{variant:"outlined",color:"primary",autoFocus:!0,onClick:async()=>{await this.doVerifyEmail()},children:"验证"}),i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"关闭"})]})]})})}failedUI=()=>!1===this.state.verify_failed?i.jsx(i.Fragment,{}):i.jsx(o.Alert,{severity:"error",children:"验证失败, 请确保您输入的验证码有效!"});doVerifyEmail=async()=>{await X.ApiEmailAppVerify.do_post({body:{unique_id:this.props.email_app.unique_id,code:this.state.verify_code}},(async e=>(console.log({resp:e}),this.setState({verify_failed:!1}),await this.props.closeHandle(),{})),(async e=>(console.error({resp:e,text:await e.text()}),this.setState({verify_failed:!0}),{})))}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),X=a("iX1d0"),$=a("6pMsr");class se extends n.Component{constructor(e){super(e),this.state={msg_list:[],loading:!1}}async componentDidMount(){try{this.setState({loading:!0});const e=await X.ApiEmailMsgList.do_get({path_args:null,query_args:{unique_id:this.props.email_unique_id},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}})||[];this.setState({msg_list:e})}finally{this.setState({loading:!1})}}render(){return null===this.props.email_unique_id?i.jsx(i.Fragment,{}):i.jsx(i.Fragment,{children:i.jsxs(o.Container,{style:{paddingTop:"35px"},children:[i.jsxs(o.Breadcrumbs,{children:[i.jsx(o.Link,{onClick:async()=>{await this.props.onCloseHandler()},children:"邮箱配置"}),i.jsx(o.Link,{children:this.props.email_address})]}),i.jsx(o.Typography,{variant:"h4",align:"center",children:"消息列表"}),i.jsx(G,{loading:this.state.loading}),this.tableUI()]})})}tableUI=()=>{if(0===this.state.msg_list.length)return i.jsx(o.Alert,{severity:"error",children:"当前没有消息"});return i.jsx(i.Fragment,{children:i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"发送IP"}),i.jsx(o.TableCell,{children:"消息类型"}),i.jsx(o.TableCell,{children:"消息内容"}),i.jsx(o.TableCell,{children:"发送时间"})]})}),i.jsx(o.TableBody,{children:this.state.msg_list.map(((e,t)=>{return l=t,a=e,i.jsx(i.Fragment,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:a.src_ip}),i.jsx(o.TableCell,{children:a.msg_type}),i.jsx(o.TableCell,{style:{maxWidth:"60vw"},children:i.jsx("pre",{children:a.content})}),i.jsx(o.TableCell,{children:new Date(a.ctime).toLocaleString()})]},l)});var l,a}))})]})})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class ie extends n.Component{constructor(e){super(e),this.state={}}render(){return null===this.props.email_app?i.jsx(i.Fragment,{}):i.jsxs("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[i.jsx("div",{children:i.jsx(Y,{value:this.notifyUrl(),label:"通知URL",helperText:"通知URL"})}),i.jsx("div",{children:i.jsx(Y,{value:this.chatwootWebookUrl(),label:"Chatwoot WebHook URL",helperText:"Chatwoot WebHook 通知 URL"})}),i.jsx("div",{children:i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandler()},children:"关闭"})})]})}chatwootWebookUrl=()=>{const e=this.props.email_app?.unique_id;return Z.buildUrlWithPath(`/api/email/chatwoot/${e}`)};notifyUrl=()=>{const e=this.props.email_app?.unique_id;return Z.buildUrlWithPath(`/api/email/notify/${e}`)}}class ne extends n.Component{constructor(e){super(e),this.state={email_list:[],loading:!1,show_verify_email:null,show_email_msg_unique_id:null,show_email_msg_email:null,show_delete_dialog:null,selected_delete_email:null,show_app_detail:null}}async componentDidMount(){await this.reloadEmailList()}render(){return this.state.show_email_msg_unique_id?i.jsx(se,{email_unique_id:this.state.show_email_msg_unique_id,email_address:this.state.show_email_msg_email,onCloseHandler:async()=>{this.setState({show_email_msg_email:null,show_email_msg_unique_id:null})}}):this.state.show_app_detail?i.jsx(ie,{email_app:this.state.show_app_detail,closeHandler:async()=>{this.setState({show_app_detail:null})}}):i.jsxs(i.Fragment,{children:[i.jsx(G,{loading:this.state.loading}),this.tableUI(),i.jsx(ae,{email_app:this.state.show_verify_email,closeHandle:async()=>{await this.reloadEmailList(),this.setState({show_verify_email:null})}})]})}reloadEmailList=async()=>{try{this.setState({loading:!0});const e=await X.ApiEmailAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});this.setState({email_list:e})}catch(e){throw e}finally{this.setState({loading:!1})}};resendBtn=(e,t)=>e?i.jsx(i.Fragment,{}):i.jsx(o.Button,{variant:"outlined",onClick:async()=>{await X.ApiEmailApp.do_put({path_args:{},query_args:{email:t},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}},(async()=>(alert("发送验证码成功"),{})),(async()=>(alert("发送验证码失败"),{})))},children:"重发验证码"});verifyBtn=(e,t)=>e?i.jsx(i.Fragment,{}):i.jsx(o.Button,{variant:"outlined",onClick:async()=>{this.setState({show_verify_email:t})},children:"验证"});viewBtn=(e,t,l)=>e?i.jsx(o.Button,{variant:"outlined",onClick:()=>{this.setState({show_email_msg_unique_id:t,show_email_msg_email:l})},children:"查看信息"}):i.jsx(i.Fragment,{});renderRow=e=>i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:i.jsx(o.Tooltip,{title:"查看详情",children:i.jsx(o.Link,{onClick:async()=>{this.setState({show_app_detail:e})},children:e.unique_id})})}),i.jsx(o.TableCell,{children:e.notify_email}),i.jsx(o.TableCell,{children:i.jsx(le,{value:e.verified})}),i.jsx(o.TableCell,{children:new Date(e.ctime).toLocaleString()}),i.jsx(o.TableCell,{children:i.jsxs(o.ButtonGroup,{children:[this.verifyBtn(e.verified,e),this.resendBtn(e.verified,e.notify_email),i.jsx(o.Tooltip,{title:"删除此配置?",placement:"top",children:i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:()=>{this.setState({show_delete_dialog:e.unique_id,selected_delete_email:e.notify_email})},children:"删除"})}),this.viewBtn(e.verified,e.unique_id,e.notify_email)]})})]},e.unique_id);tableUI=()=>{const e=this.state.email_list;return e&&0!==e.length?i.jsxs(i.Fragment,{children:[i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"唯一标识"}),i.jsx(o.TableCell,{children:"电子邮箱"}),i.jsx(o.TableCell,{children:"已验证"}),i.jsx(o.TableCell,{children:"创建时间"}),i.jsx(o.TableCell,{children:"操作"})]})}),i.jsx(o.TableBody,{children:this.state.email_list.map(this.renderRow)})]}),i.jsx(J,{content:`确认删除 ${this.state.selected_delete_email} 的配置?`,closeHandler:async()=>{this.setState({show_delete_dialog:null,selected_delete_email:null})},value:this.state.show_delete_dialog,confirmHandler:async e=>{console.log("confirm delete:",e),await X.ApiEmailApp.do_delete({path_args:null,query_args:{unique_id:this.state.show_delete_dialog},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}},(async()=>(this.setState({show_delete_dialog:null}),await this.reloadEmailList(),{})),(async()=>(alert("删除配置失败"),{})))}})]}):i.jsx(o.Typography,{align:"center",fontSize:"2em",children:"您没有电子邮箱的推送配置"})}}class re extends n.Component{constructor(e){super(e),this.state={}}render(){return i.jsx(i.Fragment,{children:i.jsx(ne,{})})}}i=a("jAw9N"),n=a("ejx16"),i=a("jAw9N"),n=a("ejx16"),X=a("iX1d0"),$=a("6pMsr"),o=a("azvlV"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class oe extends n.Component{constructor(e){super(e),this.state={}}render(){return i.jsxs(o.ButtonGroup,{children:[this.viewBtn(),this.doVerifyBtn(),this.deleteBtn()]})}viewBtn=()=>this.props.app_info.verified?i.jsx(o.Button,{onClick:async()=>{await this.props.viewMsgHandler(this.props.app_info)},children:"查看消息"}):i.jsx(i.Fragment,{});doVerifyBtn=()=>this.props.app_info.verified?i.jsx(i.Fragment,{}):i.jsx(o.Button,{onClick:async()=>{await this.props.showVerifyHandler(this.props.app_info)},children:"去验证"});deleteBtn=()=>i.jsx(o.Tooltip,{title:"删除这个推送配置",placement:"top",children:i.jsx(o.Button,{color:"secondary",onClick:async()=>{await this.props.tryDeleteHandler(this.props.app_info)},children:"删除"})})}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),X=a("iX1d0");class de extends n.Component{constructor(e){super(e),this.state={verify_code:"",verify_failed:!1}}render(){const e=this.props.dd_app;return null===e?i.jsx(i.Fragment,{}):i.jsx(i.Fragment,{children:i.jsxs(o.Dialog,{open:!0,children:[i.jsxs(o.DialogTitle,{children:["钉钉验证:",e.app_name]}),i.jsxs(o.DialogContent,{children:[this.failedUI(),i.jsx(o.DialogContentText,{children:"请在下方输入您接收到的验证码:"}),i.jsx(o.TextField,{value:this.state.verify_code,autoFocus:!0,margin:"dense",label:"验证码:",type:"text",fullWidth:!0,onChange:e=>{this.setState({verify_code:e.target.value})}})]}),i.jsxs(o.DialogActions,{children:[i.jsx(o.Button,{variant:"outlined",color:"primary",autoFocus:!0,onClick:async()=>{await this.doVerify()},children:"验证"}),i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{this.setState({verify_failed:!1}),await this.props.closeHandle(!1)},children:"关闭"})]})]})})}failedUI=()=>!1===this.state.verify_failed?i.jsx(i.Fragment,{}):i.jsx(o.Alert,{severity:"error",children:"验证失败, 请确保您输入的验证码有效!"});doVerify=async()=>{const e=this.props.dd_app;await X.ApiDdAppVerify.do_post({body:{unique_id:e.unique_id,code:this.state.verify_code}},(async()=>(this.setState({verify_failed:!1}),await this.props.closeHandle(!0),{})),(async()=>(this.setState({verify_failed:!0}),{})))}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),X=a("iX1d0"),$=a("6pMsr");class pe extends n.Component{constructor(e){super(e),this.state={msg_list:[],loading:!1}}async componentDidMount(){const e=this.props.dd_app;if(null!==e)try{this.setState({loading:!0});const t=await X.ApiDdMsgList.do_get({path_args:null,query_args:{unique_id:e.unique_id},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}})||[];this.setState({msg_list:t})}finally{this.setState({loading:!1})}}render(){const e=this.props.dd_app;return null===e?i.jsx(i.Fragment,{}):i.jsx(i.Fragment,{children:i.jsxs(o.Container,{style:{paddingTop:"35px"},children:[i.jsxs(o.Breadcrumbs,{children:[i.jsx(o.Link,{onClick:async()=>{await this.props.onCloseHandler()},children:"钉钉配置"}),i.jsx(o.Link,{children:e.app_name})]}),i.jsx(o.Typography,{variant:"h4",align:"center",children:"消息列表"}),i.jsx(G,{loading:this.state.loading}),this.tableUI()]})})}tableUI=()=>{if(0===this.state.msg_list.length)return i.jsx(o.Alert,{severity:"error",children:"当前没有消息"});return i.jsx(i.Fragment,{children:i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"发送IP"}),i.jsx(o.TableCell,{children:"消息类型"}),i.jsx(o.TableCell,{children:"消息内容"}),i.jsx(o.TableCell,{children:"发送时间"})]})}),i.jsx(o.TableBody,{children:this.state.msg_list.map(((e,t)=>{return l=t,a=e,i.jsx(i.Fragment,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:a.src_ip}),i.jsx(o.TableCell,{children:a.msg_type}),i.jsx(o.TableCell,{style:{maxWidth:"60vw"},children:i.jsx("pre",{children:a.content})}),i.jsx(o.TableCell,{children:new Date(a.ctime).toLocaleString()})]},l)});var l,a}))})]})})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class ce extends n.Component{constructor(e){super(e),this.state={}}render(){return null===this.props.dd_app?i.jsx(i.Fragment,{}):i.jsxs("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[i.jsx("div",{children:i.jsx(Y,{value:this.notifyUrl(),label:"通知URL",helperText:"通知 URL"})}),i.jsx("div",{children:i.jsx(Y,{value:this.chatwootWebHookUrl(),label:"Chatwoot WebHook URL",helperText:"Chatwoot WebHook 通知 URL"})}),i.jsx("div",{children:i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.closeHandler()},children:"关闭"})})]})}chatwootWebHookUrl=()=>{const e=this.props.dd_app?.unique_id;return Z.buildUrlWithPath(`/api/dd/chatwoot/${e}`)};notifyUrl=()=>{const e=this.props.dd_app?.unique_id;return Z.buildUrlWithPath(`/api/dd/notify/${e}`)}}class he extends n.Component{constructor(e){super(e),this.state={dd_app_list:[],loading:!1,show_app_delete:null,show_msg_list:null,show_app_verify:null,show_app_detail:null}}async componentDidMount(){await this.reloadAppList()}render(){return this.state.show_msg_list?i.jsx(pe,{dd_app:this.state.show_msg_list,onCloseHandler:async()=>{this.setState({show_msg_list:null})}}):this.state.show_app_detail?i.jsx(ce,{dd_app:this.state.show_app_detail,closeHandler:async()=>{this.setState({show_app_detail:null})}}):i.jsxs(i.Fragment,{children:[i.jsx(G,{loading:this.state.loading}),this.tableUI(),i.jsx(de,{dd_app:this.state.show_app_verify,closeHandle:async e=>{this.setState({show_app_verify:null}),e&&await this.reloadAppList()}})]})}renderRow=e=>i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:i.jsx(o.Tooltip,{title:"查看详情",children:i.jsx(o.Link,{onClick:async()=>{this.setState({show_app_detail:e})},children:e.unique_id})})}),i.jsx(o.TableCell,{children:e.app_name}),i.jsx(o.TableCell,{children:i.jsx(le,{value:e.verified})}),i.jsxs(o.TableCell,{children:[i.jsx(K,{value:e.dd_ak})," "]}),i.jsxs(o.TableCell,{children:[i.jsx(K,{value:e.dd_sk})," "]}),i.jsx(o.TableCell,{children:new Date(e.ctime).toLocaleString()}),i.jsx(o.TableCell,{children:i.jsx(oe,{app_info:e,viewMsgHandler:async e=>{this.setState({show_msg_list:e})},showVerifyHandler:async e=>{this.setState({show_app_verify:e})},tryDeleteHandler:async e=>{this.setState({show_app_delete:e})}})})]},e.unique_id);tableUI=()=>{const e=this.state.dd_app_list;return e&&0!==e.length?i.jsxs(i.Fragment,{children:[i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"唯一标识"}),i.jsx(o.TableCell,{children:"应用名称"}),i.jsx(o.TableCell,{children:"已验证"}),i.jsx(o.TableCell,{children:"访问令牌"}),i.jsx(o.TableCell,{children:"加密密钥"}),i.jsx(o.TableCell,{children:"创建时间"}),i.jsx(o.TableCell,{children:"操作"})]})}),i.jsx(o.TableBody,{children:e.map(this.renderRow)})]}),i.jsx(J,{content:`确认删除 ${this.state.show_app_delete?.app_name} 的推送配置?`,closeHandler:async()=>{this.setState({show_app_delete:null})},value:this.state.show_app_delete,confirmHandler:async e=>{await X.ApiDdApp.do_delete({query_args:{unique_id:e.unique_id},security:{bearer:$.UserLogic.getBearerToken()}},(async()=>(this.setState({show_app_delete:null}),await this.reloadAppList(),{})),(async()=>(alert("删除配置失败"),{})))}})]}):i.jsx(o.Typography,{align:"center",fontSize:"2em",children:"您没有钉钉的推送配置"})};reloadAppList=async()=>{try{this.setState({loading:!0});const e=await X.ApiDdAppList.do_get({security:{bearer:$.UserLogic.getBearerToken()}})||[];this.setState({dd_app_list:e})}finally{this.setState({loading:!1})}}}class ue extends n.Component{constructor(e){super(e),this.state={}}render(){return i.jsx(i.Fragment,{children:i.jsx(he,{})})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),i=a("jAw9N"),n=a("ejx16");class xe extends n.Component{static defaultProps={width:"auto",height:"auto"};constructor(e){super(e),this.state={}}render(){return i.jsx("div",{style:{width:this.props.width,height:this.props.height}})}}var _e=a("acJjt");$=a("6pMsr"),X=a("iX1d0");class je extends n.Component{constructor(e){super(e),this.state={app_name:"",dd_ak:"",dd_sk:""}}render(){return i.jsx(i.Fragment,{children:i.jsxs("div",{style:{width:"80%",margin:"auto"},children:[i.jsx(xe,{height:"1em"}),i.jsxs("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[i.jsx("div",{children:i.jsx(o.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的名字",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"钉钉访问令牌",variant:"outlined",value:this.state.dd_ak,helperText:"钉钉机器人的 WebHook 或者 AccessToken",fullWidth:!0,onChange:e=>{try{const t=new URL(e.target.value).searchParams.get("access_token");t?this.setState({dd_ak:t}):this.setState({dd_ak:e.target.value})}catch(t){this.setState({dd_ak:e.target.value})}}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"签名密钥",variant:"outlined",value:this.state.dd_sk,helperText:"钉钉签名密钥配置",fullWidth:!0,onChange:e=>{this.setState({dd_sk:e.target.value})}})}),i.jsx(_e.HCenterHelper,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",size:"large",onClick:async()=>{await X.ApiDdApp.do_put({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:$.UserLogic.getBearerToken()}},(async()=>(await this.props.closeHandle(),{})),(async()=>(alert("添加失败"),{})))},children:"保存"}),i.jsx(o.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),_e=a("acJjt"),X=a("iX1d0"),$=a("6pMsr");class me extends n.Component{constructor(e){super(e),this.state={email:""}}render(){return i.jsx(i.Fragment,{children:i.jsxs("div",{style:{width:"80%",margin:"auto"},children:[i.jsx(xe,{height:"1em"}),i.jsxs("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[i.jsx("div",{children:i.jsx(o.TextField,{value:this.state.email,label:"电子邮箱",variant:"outlined",helperText:"接收推送通知的电子邮箱",fullWidth:!0,onChange:e=>{this.setState({email:e.target.value})}})}),i.jsx(_e.HCenterHelper,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",size:"large",onClick:async()=>{await this.saveEmailApp()},children:"保存"}),i.jsx(o.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}saveEmailApp=async()=>{await X.ApiEmailApp.do_put({path_args:null,query_args:{email:this.state.email},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}},(async e=>(console.log({resp:e}),await this.props.closeHandle(),{})),(async e=>(console.log({text:await e.text(),resp:e}),alert("添加邮箱失败"),{})))}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),_e=a("acJjt"),$=a("6pMsr"),X=a("iX1d0");class ge extends n.Component{constructor(e){super(e),this.state={app_name:"",corp_id:"",wx_token:"",aes_key:"",agent_id:0,secret:""}}render(){return i.jsx(i.Fragment,{children:i.jsxs("div",{style:{width:"80%",margin:"auto"},children:[i.jsx(xe,{height:"1em"}),i.jsxs("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[i.jsx("div",{children:i.jsx(o.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的应用名称",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{value:this.state.corp_id,label:"企业微信公司ID",variant:"outlined",helperText:"企业微信公司的ID, 我的企业 -> 企业信息 -> 企业ID",fullWidth:!0,onChange:e=>{this.setState({corp_id:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"企业微信令牌",variant:"outlined",value:this.state.wx_token,helperText:"企业微信 -> 应用 -> API接收消息 -> token",fullWidth:!0,onChange:e=>{this.setState({wx_token:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"AES密钥",variant:"outlined",value:this.state.aes_key,helperText:"企业微信 -> 应用 -> API接收消息 -> EncodeAESKey",fullWidth:!0,onChange:e=>{this.setState({aes_key:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"AgentID",variant:"outlined",value:this.state.agent_id.toString(),type:"number",fullWidth:!0,helperText:"企业微信 -> 应用 -> AgentId",onChange:e=>{this.setState({agent_id:parseInt(e.target.value)})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"Secret",variant:"outlined",value:this.state.secret,fullWidth:!0,helperText:"企业微信 -> 应用 -> Secret",onChange:e=>{this.setState({secret:e.target.value})}})}),i.jsx(_e.HCenterHelper,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",size:"large",onClick:async()=>{await X.ApiWxApp.do_put({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:$.UserLogic.getBearerToken()}})?(alert("成功"),await this.props.closeHandle()):alert("添加失败")},children:"保存"}),i.jsx(o.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}i=a("jAw9N"),n=a("ejx16"),X=a("iX1d0"),$=a("6pMsr"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class ye extends n.Component{constructor(e){super(e),this.state={}}render(){const e=this.props.tpl_app;return null===e?i.jsx(i.Fragment,{}):i.jsxs("grid",{style:{display:"grid",gridTemplateColumns:"1fr",gridRowGap:"2em",maxWidth:"800px",margin:"auto",paddingTop:"2em"},children:[i.jsx("div",{children:i.jsx(Y,{value:this.webhookUrl(),label:"通知URL",helperText:"接收通知的URL"})}),i.jsx("div",{children:i.jsx(o.TextField,{value:e.app_name,label:"应用名称",variant:"filled",helperText:"这个应用的名字",fullWidth:!0})}),i.jsx("div",{children:i.jsx(o.TextField,{value:e.tpl_code,label:"模版代码",variant:"filled",multiline:!0,helperText:"模版的代码",fullWidth:!0})}),i.jsx("div",{children:i.jsx(o.TextField,{value:e.comment,label:"备注",variant:"filled",helperText:"这个应用的备注",multiline:!0,fullWidth:!0})}),i.jsx("div",{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",color:"secondary",onClick:async()=>{await this.props.onCloseHandler()},children:"关闭"}),i.jsx(o.Button,{variant:"outlined",onClick:async()=>{await this.props.onEditHandler(this.props.tpl_app)},children:"编辑"})]})})]})}webhookUrl=()=>{const e=this.props.tpl_app?.unique_id;return`${document.location.protocol}//${document.location.host}/api/tpl/notify/${e}`}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),_e=a("acJjt"),$=a("6pMsr"),X=a("iX1d0"),i=a("jAw9N"),n=a("ejx16"),X=a("iX1d0"),$=a("6pMsr"),o=a("azvlV");class we extends n.Component{constructor(e){super(e),this.state={app_list:[],app_loading:!0,ac_list:[]}}async componentDidMount(){await this.reloadWxList()}render(){return i.jsx(i.Fragment,{children:i.jsx(o.Autocomplete,{renderInput:e=>i.jsx(o.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{null===t?await this.props.onSelectHandler(null):await Promise.all(this.state.app_list.map((async e=>{e.app_name===t&&await this.props.onSelectHandler(e)})))}})})}reloadWxList=async()=>{try{this.setState({app_loading:!0});const e=await X.ApiWxAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});if(e){const t=e;this.setState({app_list:t,ac_list:t.map((e=>e.app_name))})}}catch(e){console.error(e)}finally{this.setState({app_loading:!1})}}}i=a("jAw9N"),n=a("ejx16"),X=a("iX1d0"),$=a("6pMsr"),o=a("azvlV");class fe extends n.Component{constructor(e){super(e),this.state={app_list:[],app_loading:!0,ac_list:[]}}async componentDidMount(){await this.reloadDdList()}render(){return i.jsx(i.Fragment,{children:i.jsx(o.Autocomplete,{renderInput:e=>i.jsx(o.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{null===t?await this.props.onSelectHandler(null):await Promise.all(this.state.app_list.map((async e=>{e.app_name===t&&await this.props.onSelectHandler(e)})))}})})}reloadDdList=async()=>{try{this.setState({app_loading:!0});const e=await X.ApiDdAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});if(e){const t=e;this.setState({app_list:t,ac_list:t.map((e=>e.app_name))})}}catch(e){console.error(e)}finally{this.setState({app_loading:!1})}}}i=a("jAw9N"),n=a("ejx16"),X=a("iX1d0"),$=a("6pMsr"),o=a("azvlV");class ve extends n.Component{constructor(e){super(e),this.state={app_list:[],app_loading:!0,ac_list:[]}}async componentDidMount(){await this.reloadEmailList()}render(){return i.jsx(i.Fragment,{children:i.jsx(o.Autocomplete,{renderInput:e=>i.jsx(o.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{null===t?await this.props.onSelectHandler(null):await Promise.all(this.state.app_list.map((async e=>{e.notify_email===t&&await this.props.onSelectHandler(e)})))}})})}reloadEmailList=async()=>{try{this.setState({app_loading:!0});const e=await X.ApiEmailAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});if(e){const t=e;this.setState({app_list:t,ac_list:t.map((e=>e.notify_email))})}}catch(e){console.error(e)}finally{this.setState({app_loading:!1})}}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV");class be extends n.Component{constructor(e){super(e),this.state={tpl_list:[],tpl_loading:!0,ac_list:[]}}async componentDidMount(){try{this.setState({tpl_loading:!0});const e=await fetch("/static/notify_tpl/builtin.json"),t=await e.json();this.setState({tpl_list:t,ac_list:t.map((e=>e.name))})}catch(e){console.error(e)}finally{this.setState({tpl_loading:!1})}}render(){return i.jsx(i.Fragment,{children:i.jsx(o.Autocomplete,{renderInput:e=>i.jsx(o.TextField,{...e,fullWidth:this.props.fullWidth,helperText:this.props.helperText,label:this.props.label,variant:"outlined"}),options:this.state.ac_list,onChange:async(e,t)=>{await Promise.all(this.state.tpl_list.map((async e=>{if(e.name===t){const t=await this.loadTplCodeByFile(e.file);await this.props.onSelectTplCode(t)}})))}})})}loadTplCodeByFile=async e=>{const t=await fetch(`/static/notify_tpl/${e}`);return t.ok?await t.text():(console.log("get tpl code error: ",t),"")}}class Te extends n.Component{constructor(e){super(e),this.state={unique_id:"",app_name:"",wx_app:null,dd_app:null,email_app:null,tpl_code:"",comment:"",cur_wx_app_name:null,cur_dd_app_name:null,cur_email_app_name:null}}async componentDidMount(){const e=await X.ApiTplApp.do_get({path_args:null,query_args:{unique_id:this.props.unique_id},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});this.setState({unique_id:e.unique_id,app_name:e.app_name,wx_app:e.wx_app?.unique_id,dd_app:e.dd_app?.unique_id,email_app:e.email_app?.unique_id,tpl_code:e.tpl_code,comment:e.comment,cur_wx_app_name:e.wx_app?.app_name,cur_dd_app_name:e.dd_app?.app_name,cur_email_app_name:e.email_app?.notify_email})}render(){return i.jsx(i.Fragment,{children:i.jsxs("div",{style:{width:"80%",margin:"auto"},children:[i.jsx(xe,{height:"1em"}),i.jsxs("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[i.jsx("div",{children:i.jsx(o.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的名字",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),i.jsx("div",{children:i.jsx(be,{label:"内置模版选择",fullWidth:!0,helperText:"您可以从内置的模版中选择您所需要的模版代码",onSelectTplCode:async e=>{this.setState({tpl_code:e})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"模版代码",multiline:!0,value:this.state.tpl_code,helperText:"这个通知使用的 Jinja2 模版",fullWidth:!0,onChange:e=>{this.setState({tpl_code:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"应用备注",multiline:!0,value:this.state.comment,helperText:"这个应用的备注",fullWidth:!0,onChange:e=>{this.setState({comment:e.target.value})}})}),i.jsx("div",{children:i.jsx(we,{label:"企业微信APP",fullWidth:!0,helperText:"选择需要接收这个通知的企业微信 APP",onSelectHandler:async e=>{this.setState({wx_app:e?.unique_id})}})}),i.jsx("div",{children:i.jsx(fe,{label:"钉钉APP",fullWidth:!0,helperText:"选择需要接收这个通知的钉钉 APP",onSelectHandler:async e=>{this.setState({dd_app:e?.unique_id})}})}),i.jsx("div",{children:i.jsx(ve,{label:"邮箱通知",fullWidth:!0,helperText:"选择需要接收这个通知的电子邮箱",onSelectHandler:async e=>{this.setState({email_app:e?.unique_id})}})}),i.jsx(_e.HCenterHelper,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",size:"large",onClick:async()=>{await X.ApiTplApp.do_patch({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:$.UserLogic.getBearerToken()}},(async e=>(await this.props.closeHandle(),await e.json())),(async()=>(alert("更新失败"),{})))},children:"更新"}),i.jsx(o.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}class Ce extends n.Component{constructor(e){super(e),this.state={show_app_detail:null,show_app_update:null}}render(){if(this.state.show_app_detail)return i.jsx(ye,{tpl_app:this.state.show_app_detail,onEditHandler:async e=>{this.setState({show_app_detail:null,show_app_update:e})},onCloseHandler:async()=>{this.setState({show_app_detail:null})}});if(this.state.show_app_update)return i.jsx(Te,{unique_id:this.state.show_app_update?.unique_id,closeHandle:async()=>{this.setState({show_app_update:null}),await this.props.reloadingHandler()}});const e=this.props.tpl_app_list;return e&&0!==e.length?i.jsxs(o.Table,{children:[i.jsx(o.TableHead,{children:i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:"唯一标识"}),i.jsx(o.TableCell,{children:"应用名称"}),i.jsx(o.TableCell,{children:"企业微信"}),i.jsx(o.TableCell,{children:"电子邮箱"}),i.jsx(o.TableCell,{children:"钉钉"}),i.jsx(o.TableCell,{children:"创建时间"}),i.jsx(o.TableCell,{children:"操作"})]})}),i.jsx(o.TableBody,{children:e.map(this.renderRow)})]}):i.jsx(o.Typography,{align:"center",fontSize:"2em",children:"您没有自定义模版推送配置"})}renderRow=e=>i.jsxs(o.TableRow,{children:[i.jsx(o.TableCell,{children:i.jsx(o.Tooltip,{title:"查看详情",children:i.jsx(o.Link,{onClick:()=>{this.setState({show_app_detail:e})},children:e.unique_id})})}),i.jsx(o.TableCell,{children:e.app_name}),i.jsx(o.TableCell,{children:e.wx_app?.app_name}),i.jsx(o.TableCell,{children:e.email_app?.notify_email}),i.jsx(o.TableCell,{children:e.dd_app?.app_name}),i.jsx(o.TableCell,{children:new Date(e.ctime).toLocaleString()}),i.jsx(o.TableCell,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",onClick:async()=>{this.setState({show_app_update:e})},children:"更新"}),i.jsx(o.Tooltip,{title:"删除此配置?",placement:"top",children:i.jsx(o.Button,{color:"secondary",variant:"outlined",onClick:async()=>{await this.props.onDeleteHandler(e)},children:"删除"})})]})})]},e.unique_id)}class Se extends n.Component{constructor(e){super(e),this.state={tpl_app_list:[],tpl_app_loading:!1,tpl_delete_app:null}}async componentDidMount(){await this.fetchTplAppList()}render(){return i.jsxs(i.Fragment,{children:[i.jsx(G,{loading:this.state.tpl_app_loading}),i.jsx(Ce,{tpl_app_list:this.state.tpl_app_list,reloadingHandler:this.fetchTplAppList,onDeleteHandler:async e=>{this.setState({tpl_delete_app:e})}}),i.jsx(J,{content:`确认删除: ${this.state.tpl_delete_app?.app_name}?`,closeHandler:async()=>{this.setState({tpl_delete_app:null})},value:this.state.tpl_delete_app,confirmHandler:async e=>{await X.ApiTplApp.do_delete({path_args:null,query_args:{unique_id:e.unique_id},header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}},(async()=>(this.setState({tpl_delete_app:null}),await this.fetchTplAppList(),{})),(async()=>{alert(`删除: ${this.state.tpl_delete_app?.app_name} 失败!`)}))}})]})}fetchTplAppList=async()=>{try{this.setState({tpl_app_loading:!0});const e=await X.ApiTplAppList.do_get({path_args:null,query_args:null,header:null,body:null,security:{bearer:$.UserLogic.getBearerToken()}});this.setState({tpl_app_list:e})}catch(e){console.error("fetch tpl app list:",e)}finally{this.setState({tpl_app_loading:!1})}}}i=a("jAw9N"),n=a("ejx16"),o=a("azvlV"),_e=a("acJjt"),$=a("6pMsr"),X=a("iX1d0");class Ae extends n.Component{constructor(e){super(e),this.state={app_name:"",wx_app:null,dd_app:null,email_app:null,tpl_code:"",comment:""}}render(){return i.jsx(i.Fragment,{children:i.jsxs("div",{style:{width:"80%",margin:"auto"},children:[i.jsx(xe,{height:"1em"}),i.jsxs("form",{style:{display:"grid",gridTemplateRows:"1fr",rowGap:"1em",width:"36em",margin:"auto"},children:[i.jsx("div",{children:i.jsx(o.TextField,{value:this.state.app_name,label:"应用名称",variant:"outlined",helperText:"方便您记忆的名字",fullWidth:!0,onChange:e=>{this.setState({app_name:e.target.value})}})}),i.jsx("div",{children:i.jsx(be,{label:"内置模版选择",fullWidth:!0,helperText:"您可以从内置的模版中选择您所需要的模版代码",onSelectTplCode:async e=>{this.setState({tpl_code:e})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"模版代码",multiline:!0,value:this.state.tpl_code,helperText:"这个通知使用的 Jinja2 模版",fullWidth:!0,onChange:e=>{this.setState({tpl_code:e.target.value})}})}),i.jsx("div",{children:i.jsx(o.TextField,{label:"应用备注",multiline:!0,value:this.state.comment,helperText:"这个应用的备注",fullWidth:!0,onChange:e=>{this.setState({comment:e.target.value})}})}),i.jsx("div",{children:i.jsx(we,{label:"企业微信APP",fullWidth:!0,helperText:"选择需要接收这个通知的企业微信 APP",onSelectHandler:async e=>{this.setState({wx_app:e?e.unique_id:null})}})}),i.jsx("div",{children:i.jsx(fe,{label:"钉钉APP",fullWidth:!0,helperText:"选择需要接收这个通知的钉钉 APP",onSelectHandler:async e=>{this.setState({dd_app:e?e.unique_id:null})}})}),i.jsx("div",{children:i.jsx(ve,{label:"邮箱通知",fullWidth:!0,helperText:"选择需要接收这个通知的电子邮箱",onSelectHandler:async e=>{console.log(e),this.setState({email_app:e?e.unique_id:null})}})}),i.jsx(_e.HCenterHelper,{children:i.jsxs(o.ButtonGroup,{children:[i.jsx(o.Button,{variant:"outlined",size:"large",onClick:async()=>{await X.ApiTplApp.do_put({path_args:null,query_args:null,header:null,body:this.state,security:{bearer:$.UserLogic.getBearerToken()}},(async e=>(await this.props.closeHandle(),await e.json())),(async()=>(alert("添加失败"),{})))},children:"保存"}),i.jsx(o.Button,{variant:"outlined",size:"large",color:"secondary",onClick:async()=>{await this.props.closeHandle()},children:"取消"})]})})]})]})})}}const ke=c();class He extends n.Component{constructor(e){super(e),this.state={}}async componentDidMount(){await $.UserLogic.doSyncIfNeeded()}render(){const e=document.location.pathname.split("/")[2]??"email";return i.jsx(i.Fragment,{children:i.jsxs(N,{children:[i.jsx(V.HeaderBlock,{}),i.jsxs(o.Tabs,{value:e,centered:!0,style:{paddingTop:"70px"},onChange:(e,t)=>{ke.push(`/config/${t}`),this.forceUpdate()},children:[i.jsx(o.Tab,{label:"电子邮箱",value:"email"}),i.jsx(o.Tab,{label:"企业微信",value:"wx"}),i.jsx(o.Tab,{label:"钉钉",value:"dd"}),i.jsx(o.Tab,{label:"自定义",value:"tpl"})]}),i.jsxs(I,{children:[i.jsx(M,{path:"/config",element:i.jsx(D,{replace:!0,to:"/config/email"})}),i.jsx(M,{path:"/config/email",element:i.jsx(re,{})}),i.jsx(M,{path:"/config/email/add",element:i.jsx(me,{closeHandle:this.closeAddHandler})}),i.jsx(M,{path:"/config/dd",element:i.jsx(ue,{})}),i.jsx(M,{path:"/config/dd/add",element:i.jsx(je,{closeHandle:this.closeAddHandler})}),i.jsx(M,{path:"/config/wx",element:i.jsx(te,{})}),i.jsx(M,{path:"/config/wx/add",element:i.jsx(ge,{closeHandle:this.closeAddHandler})}),i.jsx(M,{path:"/config/tpl",element:i.jsx(Se,{})}),i.jsx(M,{path:"/config/tpl/add",element:i.jsx(Ae,{closeHandle:this.closeAddHandler})})]}),this.fabAddButton()]})})}closeAddHandler=async()=>{const e=document.location.pathname.split("/");ke.push(`/${e[1]}/${e[2]}`),this.forceUpdate()};fabAddButton=()=>document.location.pathname.endsWith("add")?i.jsx(i.Fragment,{}):i.jsx(o.Fab,{color:"primary","aria-label":"add",style:{position:"fixed",bottom:"2em",right:"2em"},onClick:()=>{ke.push(`${document.location.pathname}/add`),this.forceUpdate()},children:i.jsx(d.Add,{})})}r.render(i.jsx(He,{}),document.querySelector("#react-root"));export{He as ConfigComponent};